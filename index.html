<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phishow Scorecard v1</title>
  <style>
    body {
      background-color: #0a0a0a;
      color: #33ff33;
      font-family: 'Courier New', Courier, monospace;
      margin: 0;
      padding: 20px;
  }
  
  .terminal {
      max-width: 1000px;
      margin: auto;
      border: 2px solid #33ff33;
      padding: 20px;
      background-color: #111;
      box-shadow: 0 0 10px #33ff33;
  }
  
  h1 {
      text-align: center;
      margin-bottom: 5px;
      color: #ff6600;
      text-shadow: 0 0 5px #ff6600;
  }
  
  h2 {
      text-align: center;
      margin-bottom: 5px;
      color: #00ccff;
      border-bottom: 1px solid #00ccff;
      padding-bottom: 5px;
  }
  
  .sys-msg {
      color: #ff3333;
      font-weight: bold;
  }
  
  select, button, input[type="text"] {
      background-color: #222;
      color: #33ff33;
      border: 1px solid #33ff33;
      padding: 5px;
      margin-top: 10px;
      font-family: inherit;
  }
  
  button:hover {
      background-color: #33ff33;
      color: #0a0a0a;
      cursor: pointer;
  }
  
  .instructions {
      border: 1px dashed #ff6600;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #1a1a1a;
  }
  
  table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 100%;
  }
  
  th {
      background-color: #00ccff;
      color: #0a0a0a;
  }
  
  th, td {
      border: 1px solid #33ff33;
      padding: 8px;
      text-align: left;
  }
  
  tr:nth-child(even) {
      background-color: #1a1a1a;
  }
  
  .show-notes {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #ff6600;
      background-color: #1a1a1a;
  }
  
  #show-rating {
      font-size: 1.2em;
      color: #ff6600;
  }

    }
    input[type="text"], select {
      background-color: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 5px;
    }
  </style>
</head>
<body>
  <div class="terminal">
    <h1>Phishow Scorecard v3</h1>
    <p><strong class="sys-msg">[SYS_MSG]</strong> Don't Suck at Phish</p>

    <div class="instructions">
      <h2>ðŸ“‹ Instructions</h2>
      <ol>
        <li>Select a show date from the dropdown.</li>
        <li>Click <strong>Generate Setlist & Scorecard</strong> to fetch real data.</li>
        <li>Rate each song using the dropdown (1â€“5).</li>
        <li>Add personal notes for standout moments.</li>
        <li>Reflect, revise, and remember: Don't Suck at Phish.</li>
      </ol>
    </div>

    <label for="showdate">Select a Show Date:</label>
    <select id="showdate" name="showdate">
      <option value="">Loading shows...</option>
    </select>
    <button onclick="loadShow()">Generate Setlist & Scorecard</button>

    <div id="show-details"></div>
    <div id="show-notes"></div>
    <div id="setlist-table"></div>
  </div>
   <script>
    const apiKey = "10645D7F59011FFA82A";
    console.log('API Key:', apiKey);

  async function fetchShows() {
    try {
      console.log('Fetching shows...');
      const apiUrl = `https://api.phish.net/v5/shows/artist/phish.json?apikey=${apiKey}`;
      console.log('API URL:', apiUrl);
  
      const response = await fetch(apiUrl);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
  
      const data = await response.json();
      console.log('Raw API Response:', data);
  
      if (data.error) {
        throw new Error(`API Error: ${data.error_message}`);
      }
  
      if (!data.data || !Array.isArray(data.data)) {
        console.log('Unexpected data structure:', data);
        throw new Error('Unexpected data structure from API');
      }
  
      console.log(`Number of shows in response: ${data.data.length}`);
  
      const showSelect = document.getElementById('showdate');
      showSelect.innerHTML = '<option value="">-- Choose a date --</option>';
  
      data.data.forEach(show => {
        const option = document.createElement('option');
        option.value = show.showdate;
        option.textContent = `${show.showdate} - ${show.venue}`;
        showSelect.appendChild(option);
      });
  
      console.log(`Added ${data.data.length} shows to dropdown`);
    } catch (error) {
      console.error('Error fetching shows:', error);
      document.getElementById('showdate').innerHTML = 
        '<option value="">Error loading shows: ' + error.message + '</option>';
  }
}

    async function loadShow() {
    const date = document.getElementById("showdate").value;
    if (!date) return alert("Please select a show date.");
  
    try {
      console.log('Loading show for date:', date);
      
      const setlistUrl = `https://api.phish.net/v5/setlists/showdate/${date}.json?apikey=${apiKey}`;
      console.log('Setlist URL:', setlistUrl);
      
      const setlistResponse = await fetch(setlistUrl);
      const setlistResult = await setlistResponse.json();
      
      console.log('Setlist Response:', setlistResult);
  
      if (!setlistResult.data || setlistResult.data.length === 0) {
        throw new Error('No setlist data found for this date.');
      }
  
      // Get the first show data entry
      const showData = setlistResult.data[0];
      console.log('Show Data:', showData);
  
      // Show Details
      document.getElementById("show-details").innerHTML = `
        <h2>Show Details</h2>
        <p><strong>Date:</strong> ${showData.showdate || 'N/A'}</p>
        <p><strong>Venue:</strong> ${showData.venue || 'N/A'}</p>
        <p><strong>Location:</strong> ${showData.city || 'N/A'}, ${showData.state || 'N/A'}, ${showData.country || 'N/A'}</p>
      `;
  
      // Show Notes
      let notesHTML = `
        <div class="show-notes">
          <h2>Show Notes</h2>
          <p>${showData.setlistnotes || "No notes available for this show."}</p>
        </div>
      `;
      document.getElementById("show-notes").innerHTML = notesHTML;
  
      // Get the setlist data - parse it like the Power Query
      const setlistEntries = setlistResult.data;
      console.log('Setlist Entries:', setlistEntries);
  
      // Setlist & Scorecard
      let setlistHTML = `
        <h2>Setlist & Ratings</h2>
        <table>
          <thead>
            <tr>
              <th>Set</th>
              <th>Song</th>
              <th>Jam Chart</th>
              <th>Gap</th>
              <th>Rating (1-5)</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
      `;
  
      if (setlistEntries.length <= 1) {
        setlistHTML += '<tr><td colspan="6">No setlist data available for this show.</td></tr>';
      } else {
        // Skip the first entry as it's the show info
        for (let i = 1; i < setlistEntries.length; i++) {
          const entry = setlistEntries[i];
          setlistHTML += `
            <tr>
              <td>${entry.set || ''}</td>
              <td>${entry.song || ''}</td>
              <td>${entry.jamchart ? 'âœ“' : ''}</td>
              <td>${entry.gap || 'N/A'}</td>
              <td>
                <select style="width: 60px;">
                  <option value="">--</option>
                  <option value="5">5</option>
                  <option value="4">4</option>
                  <option value="3">3</option>
                  <option value="2">2</option>
                  <option value="1">1</option>
                </select>
              </td>
              <td><input type="text" style="width: 100%;" placeholder="Add notes..."></td>
            </tr>
          `;
        }
      }
  
      setlistHTML += `
        </tbody>
      </table>
      <div style="margin-top: 20px; text-align: right;">
        <button onclick="calculateAverage()">Calculate Show Rating</button>
        <span id="show-rating" style="margin-left: 10px;"></span>
      </div>
      `;
  
      document.getElementById("setlist-table").innerHTML = setlistHTML;
      console.log('Setlist table generated');
  
    } catch (error) {
      console.error('Error details:', error);
      alert('Error loading show data: ' + error.message);
      document.getElementById("show-details").innerHTML = "<p>Error loading show details.</p>";
      document.getElementById("show-notes").innerHTML = "";
      document.getElementById("setlist-table").innerHTML = "";
  }
}
    function calculateAverage() {
      const ratings = document.querySelectorAll('#setlist-table select');
      let sum = 0;
      let count = 0;

      ratings.forEach(select => {
        if (select.value) {
          sum += parseInt(select.value);
          count++;
        }
      });

      const average = count > 0 ? (sum / count).toFixed(2) : 'No ratings yet';
      document.getElementById('show-rating').innerHTML = `<strong>Show Rating:</strong> ${average}`;
    }

    // Initialize by fetching shows
    fetchShows();
  </script>
</body>
</html>
