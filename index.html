<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phishow Scorecard v1</title>
  <style>
    body {
      background-color: #000;
      color: #0f0;
      font-family: 'Courier New', Courier, monospace;
      margin: 0;
      padding: 20px;
    }
    .terminal {
      max-width: 1000px;
      margin: auto;
      border: 2px solid #0f0;
      padding: 20px;
      background-color: #111;
    }
    h1 {
      text-align: center;
      margin-bottom: 5px;
      color: #fff;  /* White title */
    }
    h2 {
      text-align: center;
      margin-bottom: 5px;
      color: #fff;  /* White headers */
    }
    .sys-msg {
      color: #f00;  /* Red system message */
    }
    select, button {
      background-color: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 5px;
      margin-top: 10px;
      font-family: inherit;
    }
    .instructions {
      border: 1px dashed #0f0;
      padding: 10px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    #show-details, #show-notes, #setlist-table {
      margin-top: 20px;
    }
    table {
      border-collapse: collapse;
      margin-top: 20px;
      width: 100%;
    }
    th, td {
      border: 1px solid #0f0;
      padding: 8px;
      text-align: left;
    }
    .show-notes {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #0f0;
  
    }
    input[type="text"], select {
      background-color: #000;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 5px;
    }
  </style>
</head>
<body>
  <div class="terminal">
    <h1>Phishow Scorecard v1</h1>
    <p><strong class="sys-msg">[SYS_MSG]</strong> Don't Suck at Phish</p>

    <div class="instructions">
      <h2>ðŸ“‹ Instructions</h2>
      <ol>
        <li>Select a show date from the dropdown.</li>
        <li>Click <strong>Generate Setlist & Scorecard</strong> to fetch real data.</li>
        <li>Rate each song using the dropdown (1â€“5).</li>
        <li>Add personal notes for standout moments.</li>
        <li>Reflect, revise, and remember: Don't Suck at Phish.</li>
      </ol>
    </div>

    <label for="showdate">Select a Show Date:</label>
    <select id="showdate" name="showdate">
      <option value="">Loading shows...</option>
    </select>
    <button onclick="loadShow()">Generate Setlist & Scorecard</button>

    <div id="show-details"></div>
    <div id="show-notes"></div>
    <div id="setlist-table"></div>
  </div>
   <script>
    const apiKey = "10645D7F59011FFA82A";
    console.log('API Key:', apiKey);

  async function fetchShows() {
    try {
      console.log('Fetching shows...');
      const apiUrl = `https://api.phish.net/v5/shows/artist/phish.json?apikey=${apiKey}`;
      console.log('API URL:', apiUrl);
  
      const response = await fetch(apiUrl);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
  
      const data = await response.json();
      console.log('Raw API Response:', data);
  
      if (data.error) {
        throw new Error(`API Error: ${data.error_message}`);
      }
  
      if (!data.data || !Array.isArray(data.data)) {
        console.log('Unexpected data structure:', data);
        throw new Error('Unexpected data structure from API');
      }
  
      console.log(`Number of shows in response: ${data.data.length}`);
  
      const showSelect = document.getElementById('showdate');
      showSelect.innerHTML = '<option value="">-- Choose a date --</option>';
  
      data.data.forEach(show => {
        const option = document.createElement('option');
        option.value = show.showdate;
        option.textContent = `${show.showdate} - ${show.venue}`;
        showSelect.appendChild(option);
      });
  
      console.log(`Added ${data.data.length} shows to dropdown`);
    } catch (error) {
      console.error('Error fetching shows:', error);
      document.getElementById('showdate').innerHTML = 
        '<option value="">Error loading shows: ' + error.message + '</option>';
  }
}

    async function loadShow() {
    const date = document.getElementById("showdate").value;
    if (!date) return alert("Please select a show date.");

    try {
      console.log('Loading show for date:', date);
      const apiUrl = `https://api.phish.net/v5/setlists/showdate/${date}.json?apikey=${apiKey}`;
      console.log('API URL:', apiUrl);
      
      const response = await fetch(apiUrl);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const result = await response.json();
      console.log('API Response:', result);
  
      if (result.error) {
        throw new Error(`API Error: ${result.error_message}`);
      }
  
      if (!result.data || result.data.length === 0) {
        throw new Error('No show data found for this date.');
      }
  
      const show = result.data[0];
      console.log('Show data:', show);
  
      if (!show) {
        throw new Error('Show data is undefined or null');
      }
  
      // Show Details
      document.getElementById("show-details").innerHTML = `
        <h2>Show Details</h2>
        <p><strong>Date:</strong> ${show.showdate || 'N/A'}</p>
        <p><strong>Venue:</strong> ${show.venue || 'N/A'}</p>
        <p><strong>Location:</strong> ${show.city || 'N/A'}, ${show.state || 'N/A'}, ${show.country || 'N/A'}</p>
      `;
  
      // Show Notes
      let notesHTML = `
        <div class="show-notes">
          <h2>Show Notes</h2>
          <p>${show.setlistnotes || "No notes available for this show."}</p>
        </div>
      `;
      document.getElementById("show-notes").innerHTML = notesHTML;
  
      // Setlist & Scorecard
      let setlistHTML = `
        <h2>Setlist & Ratings</h2>
        <table>
          <thead>
            <tr>
              <th>Set</th>
              <th>Song</th>
              <th>Jh>Jam Chart</th>
              <th>Gap</th>
              <th>Rating (1-5)</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
      `;
  
      // Parse setlist data
      const songs = show.setlistdata ? show.setlistdata.split(', ') : [];
      const sets = show.setlist ? show.setlist.split(', ') : [];
  
      console.log('Songs:', songs);
      console.log('Sets:', sets);
  
      if (songs.length === 0) {
        setlistHTML += '<tr><td colspan="6">No setlist data available for this show.</td></tr>';
      } else {
        songs.forEach((song, index) => {
          setlistHTML += `
            <tr>
              <td>${sets[index] || ''}</td>
              <td>${song}</td>
              <td>${show.isjamchart ? 'âœ“' : ''}</td>
              <td>${show.gap || 'N/A'}</td>
              <td>
                <select style="width: 60px;">
                  <option value="">--</option>
                  <option value="5">5</option>
                  <option value="4">4</option>
                  <option value="3">3</option>
                  <option value="2">2</option>
                  <option value="1">1</option>
                </select>
              </td>
              <td><input type="text" style="width: 100%;" placeholder="Add notes..."></td>
            </tr>
          `;
        });
      }

    setlistHTML += `
      </tbody>
    </table>
    <div style="margin-top: 20px; text-align: right;">
      <button onclick="calculateAverage()">Calculate Show Rating</button>
      <span id="show-rating" style="margin-left: 10px;"></span>
    </div>
    `;

    document.getElementById("setlist-table").innerHTML = setlistHTML;
    console.log('Setlist table generated');

  } catch (error) {
    console.error('Error details:', error);
    alert('Error loading show data: ' + error.message);
    document.getElementById("show-details").innerHTML = "<p>Error loading show details.</p>";
    document.getElementById("show-notes").innerHTML = "";
    document.getElementById("setlist-table").innerHTML = "";
  }
}

    function calculateAverage() {
      const ratings = document.querySelectorAll('#setlist-table select');
      let sum = 0;
      let count = 0;

      ratings.forEach(select => {
        if (select.value) {
          sum += parseInt(select.value);
          count++;
        }
      });

      const average = count > 0 ? (sum / count).toFixed(2) : 'No ratings yet';
      document.getElementById('show-rating').innerHTML = `<strong>Show Rating:</strong> ${average}`;
    }

    // Initialize by fetching shows
    fetchShows();
  </script>
</body>
</html>
