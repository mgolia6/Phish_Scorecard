<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phishow Scorecard v1</title>
  <style>
    /* ... [Your existing styles] ... */
    .debug {
      background-color: #111;
      padding: 10px;
      margin: 10px 0;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>PHISHOW SCORECARD v1</h1>
  <p>:: Don't Suck at Phish ::</p>

  <label for="showSelect">Choose a show:</label>
  <select id="showSelect">
    <option value="">Loading shows...</option>
  </select>
  <button onclick="loadShow()">Load Setlist & Ratings</button>

  <!-- Add debug sections -->
  <div id="debugShows" class="debug"></div>
  <div id="debugSetlist" class="debug"></div>

  <div id="showDetails" class="section"></div>
  <div id="showNotes" class="section"></div>
  <div id="ratingGuide" class="section">
    <!-- ... [Your existing rating guide] ... -->
  </div>
  <div id="setlistRatings" class="section"></div>

  <script>
    const apiKey = 10645D7F59011FFA82A; // Replace with your actual key
    const showSelect = document.getElementById('showSelect');
    const showDetails = document.getElementById('showDetails');
    const showNotes = document.getElementById('showNotes');
    const setlistRatings = document.getElementById('setlistRatings');
    const debugShows = document.getElementById('debugShows');
    const debugSetlist = document.getElementById('debugSetlist');

    async function fetchShows() {
      try {
        const response = await fetch(`https://api.phish.net/v5/shows/all?apikey=${apiKey}`);
        const data = await response.json();
        
        // Debug output
        debugShows.innerHTML = 'Shows API Response:\n' + JSON.stringify(data, null, 2);

        if (data.error) {
          throw new Error(data.error_message || 'API Error');
        }

        showSelect.innerHTML = '<option value="">Select a show</option>';
        if (data.data && Array.isArray(data.data)) {
          data.data.forEach(show => {
            const option = document.createElement('option');
            option.value = show.showdate;
            option.textContent = `${show.showdate} â€“ ${show.venue}`;
            showSelect.appendChild(option);
          });
        }
      } catch (error) {
        console.error('Error fetching shows:', error);
        debugShows.innerHTML = 'Error fetching shows: ' + error.message;
        showSelect.innerHTML = '<option value="">Failed to load shows</option>';
      }
    }

    async function loadShow() {
      const showDate = showSelect.value;
      if (!showDate) return;

      try {
        const response = await fetch(`https://api.phish.net/v5/setlists/showdate/${showDate}.json?apikey=${apiKey}`);
        const data = await response.json();
        
        // Debug output
        debugSetlist.innerHTML = 'Setlist API Response:\n' + JSON.stringify(data, null, 2);

        if (data.error) {
          throw new Error(data.error_message || 'API Error');
        }

        if (!data.data || data.data.length === 0) {
          throw new Error('No data returned for this show');
        }

        const show = data.data[0];

        // Show Details
        showDetails.innerHTML = `
          <h2>Show Details</h2>
          <p><strong>Date:</strong> ${show.showdate}</p>
          <p><strong>Venue:</strong> ${show.venue}</p>
          <p><strong>Location:</strong> ${show.city}, ${show.state},e}, ${show.country}</p>
        `;

        // Show Notes
        showNotes.innerHTML = `
          <h2>Show Notes</h2>
          <p>${show.setlistnotes || 'No notes available for this show.'}</p>
        `;

        // Setlist & Ratings
        let tableHTML = `
          <h2>Setlist & Ratings</h2>
          <table>
            <tr>
              <th>Set</th>
              <th>Song</th>
              <th>Jam Chart</th>
              <th>Gap</th>
              <th>Rating (1-5)</th>
              <th>Notes</th>
            </tr>
        `;

        // If we have a longlist property, use that
        const songs = show.longlist ? show.longlist.split(', ') : [];
        const sets = show.setlist ? show.setlist.split(', ') : [];

        songs.forEach((song, index) => {
          tableHTML += `
            <tr>
              <td>${sets[index] || ''}</td>
              <td>${song}</td>
              <td>${'N/A'}</td>
              <td>${'N/A'}</td>
              <td><input type="number" min="1" max="5" style="width: 50px;"></td>
              <td><input type="text" style="width: 100%;"></td>
            </tr>
          `;
        });

        tableHTML += `
          </table>
          <div style="margin-top: 20px;">
            <button onclick="calculateAverage()">Calculate Show Rating</button>
            <span id="showRating" style="margin-left: 20px;"></span>
          </div>
        `;
        
        setlistRatings.innerHTML = tableHTML;

      } catch (error) {
        console.error('Error loading show:', error);
        debugSetlist.innerHTML = 'Error loading setlist: ' + error.message;
        showDetails.innerHTML = '<p>Failed to load show details.</p>';
        showNotes.innerHTML = '';
        setlistRatings.innerHTML = '';
      }
    }

    function calculateAverage() {
      const ratings = document.querySelectorAll('#setlistRatings input[type="number"]');
      let sum = 0;
      let count = 0;
      
      ratings.forEach(input => {
        if (input.value) {
          sum += parseInt(input.value);
          count++;
        }
      });

      const average = count > 0 ? (sum / count).toFixed(2) : 'No ratings yet';
      document.getElementById('showRating').innerHTML = `<strong>Show Rating:</strong> ${average}`;
    }

    fetchShows();
  </script>
</body>
</html>
